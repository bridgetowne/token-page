<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width-device width, initial-scale-1.0" />
      <link rel="stylesheet" href="./style.css" />
      <!--
      Simple Tony v1.0 

      -->
        <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <title>Simple Tony | Bridgetowne Solana Token </title>
  </head>
  <body>
    <header>
      <p>Simple Tony | Casual Desktop WEB3 Game</p>
    </header>
    <main>
      <canvas id="gameCanvas"></canvas>
    </main>
    <footer>Support this project by holding &nbsp <a href="https://solscan.io/token/8FdyCECguNHdG5RZ5a6CjDr7eUPeFy8p1eaU3HgdX1wJ" style="color: green; " >Bridgetowne</a> &nbsp SPL token</footer>
    <script >

    const gscreen = {
      width: 800,
      height: 600
    }

    const gravy = 200
    const trapspd = 190

    class PepeCatchGame extends Phaser.Scene
    {


        constructor(){
          super({ key: 'PepeCatchGame' });
          this.player
          this.cursor
          this.playerSpeed=gravy+50
          this.target
          this.trap
          this.trap2
          this.trap3
          this.trap4
          this.trap5
          this.points = 0
          this.textScore
          this.randomizer
          this.bgMusic
          this.coinAudio
          this.laughAudio
          this.emitter
        }

        preload ()
        {
            this.load.image('sky', 'assets/skies/gamebg.png');
            this.load.image('red', 'assets/particles/red.png');
            this.load.image('player', 'assets/sprites/hero.png');
            this.load.image('plyrslips', 'assets/sprites/slips.png');
            this.load.image('star', 'assets/sprites/target.png');
            this.load.image('trap', 'assets/sprites/degen.png');
            this.load.audio('bgMusic', 'assets/music/bgmusic.mp3');
            this.load.audio('coinsAudio', 'assets/audio/coins.wav');
            this.load.audio('laughAudio', 'assets/audio/lolz.wav');
            this.load.image('btc', 'assets/sprites/btc.png');

        }

        create ()
        {
            this.coinAudio = this.sound.add("coinsAudio")
            this.laughAudio = this.sound.add("laughAudio")


            this.bgMusic = this.sound.add("bgMusic");
            this.bgMusic.setVolume(0.1);
            this.bgMusic.loop = true;
            this.bgMusic.play();

            this.add.image(0, 0, 'sky').setOrigin(0,0);
            this.player = this.physics.add.image(200,400, 'player').setOrigin(0,0);
            this.player.setImmovable(true);
            this.player.body.allowGravity = false;
            this.player.setCollideWorldBounds(true);

            this.target = this.physics.add.image(this.getRandomX(),0, 'star').setOrigin(0,0);
            this.target.setMaxVelocity(0,gravy);

            this.trap = this.physics.add.image(this.getRandomX(),0, 'trap').setOrigin(0,0)
            this.trap.setMaxVelocity(0,trapspd);

            this.trap2 = this.physics.add.image(this.getRandomX(),0, 'trap').setOrigin(0,0)
            this.trap2.setMaxVelocity(0,trapspd);

            this.trap3 = this.physics.add.image(this.getRandomX(),0, 'trap').setOrigin(0,0)
            this.trap3.setMaxVelocity(0,trapspd);

            this.trap4 = this.physics.add.image(this.getRandomX(),0, 'trap').setOrigin(0,0)
            this.trap4.setMaxVelocity(0,trapspd);

            this.trap5 = this.physics.add.image(this.getRandomX(),0, 'trap').setOrigin(0,0)
            this.trap5.setMaxVelocity(0,trapspd);

            this.physics.add.overlap(this.target,this.player,this.targetHit, null, this)
            this.physics.add.overlap(this.trap,this.player,this.trapHit, null, this)
            this.physics.add.overlap(this.trap2,this.player,this.trap2Hit, null, this)
            this.physics.add.overlap(this.trap3,this.player,this.trap3Hit, null, this)
            this.physics.add.overlap(this.trap4,this.player,this.trap4Hit, null, this)
            this.physics.add.overlap(this.trap5,this.player,this.trap5Hit, null, this)

            this.cursor=this.input.keyboard.createCursorKeys();
            this.textScore = this.add.text(gscreen.width - 790, 10, "BTC: 0",{
              font: "25px Arial",
              fill: "#FFD700"
            });

            this.emitter=this.add.particles(0,0,"btc",{
              speed:100,
              gravityY:gravy-200,
              scale:0.8,
              duration:100,
              lifespan: 1000,
              alpha: { start: 1, end: 0, ease: 'Linear', duration: 500 },
              blendMode: 'ADD',
              emitting:false
            })
            this.emitter.startFollow(this.player, this.player.width /2, this.player.height / 2, true)
        }

        update(){
          if(this.target.y >= gscreen.height){
            this.target.setY(0);
            this.target.setX(this.getRandomX());
          }

          if(this.trap.y >= gscreen.height){
            this.trap.setY(0);
            this.trap.setX(this.getRandomX());
          }

          if(this.trap2.y >= gscreen.height){
            this.trap2.setY(0);
            this.trap2.setX(this.getRandomX());
          }

          if(this.trap3.y >= gscreen.height){
            this.trap3.setY(0);
            this.trap3.setX(this.getRandomX());
          }

          if(this.trap4.y >= gscreen.height){
            this.trap4.setY(0);
            this.trap4.setX(this.getRandomX());
          }

          if(this.trap5.y >= gscreen.height){
            this.trap5.setY(0);
            this.trap5.setX(this.getRandomX());
          }

          const {left,right}=this.cursor

          if(left.isDown){
            this.player.setVelocityX(-this.playerSpeed);
            this.player.flipX=true;
          }else if(right.isDown){
            this.player.setVelocityX(this.playerSpeed);
            this.player.flipX=false;
          }else{
            this.player.setVelocityX(0);
          }

        }

        getRandomX(){
          return Math.floor(Math.random()*480);
        }

        targetHit(){
          this.coinAudio.play()
          this.emitter.start()
          this.target.setY(0);
          this.target.setX(this.getRandomX());
          this.points++
          this.textScore.setText(`BTC: ${this.points}`)
        }

        trapHit(){
          this.laughAudio.play()
          this.trap.setY(0);
          this.trap.setX(this.getRandomX());
          this.points=0
          this.textScore.setText(`BTC: ${this.points}`)
          this.player.setTexture('plyrslips');
          this.time.delayedCall(250, () => {
                        this.player.setTexture('player');
           });
        }

        trap2Hit(){
          this.laughAudio.play()
          this.trap2.setY(0);
          this.trap2.setX(this.getRandomX());
          this.points=0
          this.textScore.setText(`BTC: ${this.points}`)
          this.player.setTexture('plyrslips');
          this.time.delayedCall(250, () => {
                        this.player.setTexture('player');
           });
        }

        trap3Hit(){
          this.laughAudio.play()
          this.trap3.setY(0);
          this.trap3.setX(this.getRandomX());
          this.points=0
          this.textScore.setText(`BTC: ${this.points}`)
          this.player.setTexture('plyrslips');
          this.time.delayedCall(250, () => {
                        this.player.setTexture('player');
           });
        }

        trap4Hit(){
          this.laughAudio.play()
          this.trap4.setY(0);
          this.trap4.setX(this.getRandomX());
          this.points=0
          this.textScore.setText(`BTC: ${this.points}`)
          this.player.setTexture('plyrslips');
          this.time.delayedCall(250, () => {
                        this.player.setTexture('player');
           });
        }

        trap5Hit(){
          this.laughAudio.play()
          this.trap5.setY(0);
          this.trap5.setX(this.getRandomX());
          this.points=0
          this.textScore.setText(`BTC: ${this.points}`)
          this.player.setTexture('plyrslips');
          this.time.delayedCall(250, () => {
                        this.player.setTexture('player');
           });
        }
    }

    class Intro extends Phaser.Scene
    {
        constructor ()
        {
            super({ key: 'Intro' });
        }

        preload ()
        {
            this.load.image('introScne', 'assets/pics/intro.png');
        }

        create ()
        {
              this.add.image(0, 0, 'introScne').setOrigin(0,0);

            this.input.once('pointerdown', function ()
            {

                this.scene.start('PepeCatchGame');

            }, this);
        }
    }

    const config = {
        type: Phaser.WEBGL,
        width: gscreen.width,
        height: gscreen.height,
        canvas:gameCanvas,
        scene: [Intro, PepeCatchGame],
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: gravy },
                debug: false
            }
        }
    };

    const game = new Phaser.Game(config);
    </script>
  </body>
</html>
